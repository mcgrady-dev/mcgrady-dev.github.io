# Android ScreentAdapter

## 适配方案

### 1. dp适配

使用Android推荐的dp作为尺寸单位来适配UI，dp指的是设备独立像素，以dp为尺寸单位的控件，**在不同分辨率和尺寸的手机上代表了不同的真实像素**，比如在分辨率较低的手机中，可能1dp=1px，而在分辨率较高的手机中，可能1dp=2px，这样的话，一个96*96的控件，在不同的手机中就能表现出差不多的大小，那么系统都是通过 `px = dp(dpi/160)` 公式来判断px和dp的关系的。

#### dpi

dpi是像素密度，指的是**系统软件上指定**的单位尺寸的像素数量，它往往是写在系统出厂配置文件的一个固定值。

讲清楚dpi之前，先来看看ppi，ppi是指手机屏幕中的像素密度，它是物理上的里概念，且客观存在的不会改变；而dpi是然间参考了物理像素密度后，人为指定的一个值，这样保证了某个区间内的物理像素密度在软件上都使用同一个值，这样有利于我们的UI适配。

#### 缺点

通过dp加上自适应布局和weight比例布局可以基本解决不同手机上适配的问题，这基本是最原始的Android适配方案。但这种方式存在的问题：

- 这只能保证我们写出来的界面适配绝大部分手机，部分手机仍然需要单独适配
  为什么dp只解决了90%的适配问题，因为并不是所有1080p的手机dpi都是480，比如Google Pixel 2的dpi是420，这样会导致相同分辨率的手机中，同样的控件的实际大小会有所不同。
- 这种方式无法快速高效的把设计师的十几稿实现到布局代码中
  基本都是通过百分比、估算、或者设定一个范围值等等。设计稿的控件是`128px*128px`，当我们在编写layout文件的时候，却不能直接写成`128dp*128dp`，在把设计稿向UI代码转换的过程中，我们需要耗费精力去转换尺寸，这会降低生产力，拉低开发效率。

### 2. 宽高限定符适配

宽高限定符适配方案就是穷举市面上所有的Android手机的宽高像素值，是定一个基准的分辨率，其它分辨率都根据基准来计算，在不同的尺寸文件夹内部，根据该尺寸编写对应的dimens文件。

#### 原理

当App运行在不同分辨率的设备中，系统会根据这些dimens引用去对应的分辨率文件夹下找对应的值。

#### 缺点

虽然这样基本解决了我们的适配问题，和提高UI开发效率，但这个方案有个致命的缺陷，就是要精准命中分辨率才能适配，否则只能用统一的默认dimens文件，而使用默认的尺寸UI有可能变形，容错机制很差。

### 3. UI适配框架（已停止维护）

[鸿洋大佬的适配方案](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FhongyangAndroid%2FAndroidAutoLayout)的项目也来自于宽高限定符方案的启发。

#### 原理

解析AndroidManifest中标注的设计稿尺寸

```xml
<meta-data android:name="design_width" android:value="768">
</meta-data>
<meta-data android:name="design_height" android:value="1280">
</meta-data>
```

框架会根据不同的设备的具体尺寸按比例伸缩。

#### 优点

在宽高限定符适配的基础上更进一步，更高效更精准，并且解决了容错机制问题。

#### 缺点

- 框架在运行时会在onMeasure里做变换，自定义View可能会被影响，需要单独适配，这里面的问题是不可预见的
- 停止维护

### 4. smallestWidth适配

smallestWidth适配，或者叫sw限定符适配，指的是Android会识别**屏幕可用高度和宽度的最小尺寸**的dp值，然后根据结果去资源文件中找对应限定符的文件夹下的资源文件。

#### 原理

与宽高限定符适配原理上一样，都是通过特定的规则来选择对应的文件。区别在于smallestWidth有很好的容错机制，当系统识别到手机的smallestWidth值时，就会自动去寻找和目标数据最近的资源文件的尺寸。

#### 优点

- smallestWidth方案的特性很好的解决了宽高限定符的容错问题
- 原生dp适配遇到Pixel 2这种特别的手机需要单独适配，在smallestWidth适配中，通过计算只需要生成一个values-sw411dp就能解决问题
- smallestWidth的适配机制由系统保证，我们只需要针对这套规则生成对应的资源文件即可

#### 缺点

- smallestWidth适配方案是在Android 3.2 以后引入的，Google的本意是用它来适配平板的布局文件，所以不支持3.2以下机型
- 由于dimens文件覆盖的尺寸，apk可能会增大300kb~800kb左右
- smallestWidth限定符适配的效果是让不同分辨率和密度的设备上能达到以设计稿等比缩放的适配，如果设备与设计图相差太大时并不能达到很好的适配效果，需要单独出图

### 5. 今日头条适配方案

#### 原理

通过修改density值，强行把所有不同尺寸分辨率的手机的宽度dp值改成统一的值，这样就解决了所有的适配问题。

比如设计稿宽度是360px，那么开发会把目标dp值设为360dp，在不同的设备中，动态修改了density值，从而保证（手机像素宽度）px/density这个值始终是360dp。



#### 优点

- 入侵性很低

#### 缺点

- AndroidAutoSize版本，density容易被戳改导致适配失效
- AndroidUtilCode版本，需要在Base里执行density适配（耦合性高）

